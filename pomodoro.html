<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>StudyVueJs</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script src="https://unpkg.com/vue"></script>
    </head>
    <body>
        <div id="app">
            <div class="page-header">
                <h1>
                    <span>POMODORO</span>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default" @click="start()"><span class="glyphicon glyphicon-play"></span></button>
                        <button type="button" class="btn btn-default" @click="pause()"><span class="glyphicon glyphicon-pause"></span></button>
                        <button type="button" class="btn btn-default" @click="stop()"><span class="glyphicon glyphicon-stop"></span></button>
                    </div>
                </h1>
            </div>
            <h4>STATE : {{title}}...</h4>
            <div class="well">
                <div class="pomodoro-timer">
                    <span>{{remainingMinute}}</span>:<span>{{remainingSecond}}</span>
                </div>
            </div>
            <div class="well" v-if="!isWorking">
                <img src="kitty.png">
            </div>
        </div>
    </body>
    <script>
        const STATE = {
            WORK : "work"
            , REST : "rest"
        };
        
        const TIMER_STATE = {
            STARTED : "stated"
            , STOPPED : "stopped"
            , PAUSED : "paused"
        };

        const MINUTES_WORKIG_TIME = 25;
        const MINUTES_REST_TIME = 5;
        const ONE_SECOND = 1000;

        var data = {
            minute : MINUTES_WORKIG_TIME
            , second : 0
            , state : STATE.WORK
            , timestamp : 0
            , timerState : TIMER_STATE.STOPED
        };

        new Vue({
            el : "#app"
            , data : data
            , computed : {
                title : function() {
                    return this.state == STATE.WORK ? "working" : "rest";
                }
                , remainingMinute : function() {
                    return (this.minute < 10)? "0" + this.minute : this.minute;
                }
                , remainingSecond : function() {
                    return (this.second < 10)? "0" + this.second : this.second;
                }
                , isWorking : function() {
                    return this.state == STATE.WORK;
                }
            }
            , methods : {
                start : function() {
                    this.timerState = TIMER_STATE.STARTED;
                    this._tick();
                    this.interval = setInterval(this._tick, ONE_SECOND);
                }
                , pause : function() {
                    this.timerState = TIMER_STATE.PAUSED;
                    clearInterval(this.interval);
                }
                , stop : function() {
                    this.timerState = TIMER_STATE.STOPPED;
                    clearInterval(this.interval);
                    this.state = STATE.WORK;
                    this.minute = MINUTES_WORKIG_TIME;
                    this.second = 0;
                }
                , _tick : function() {
                    if(this.second !== 0) {
                        this.second--;
                        return;
                    }
                    
                    if(this.minute !== 0) {
                        this.minute --;
                        this.second = 59;
                        return;
                    }

                    if(this.minute === 0 && this.second === 0 ) {
                        this.state = (this.state === STATE.WORK)? STATE.REST : STATE.WORK;

                        switch (this.state) {
                            case STATE.WORK :
                            this.minute = MINUTES_WORKIG_TIME;
                            break;

                            case STATE.REST :
                            this.minute = MINUTES_REST_TIME;
                            break;
                        }
                    }
                }
            }
        });
                
    </script>
</html>